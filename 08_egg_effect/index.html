<!doctype html>
<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Egg Tap — ひび割れエフェクト</title>
		<style>
			:root{
				--bg:#f7f7fb;
				--egg:#fffef6;
				--egg-shadow:rgba(0,0,0,0.12);
				--crack:#c9a890;
			}
			html,body{height:100%;}
			body{
				margin:0;
				font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "メイリオ", sans-serif;
				background:linear-gradient(180deg,var(--bg),#eef2ff 70%);
				display:flex;
				align-items:center;
				justify-content:center;
			}
			.wrap{
				width:min(960px,94vw);
				padding:24px;
			}
			h1{font-size:20px;margin:0 0 12px 0;text-align:center}
			.grid{
				display:grid;
				grid-template-columns:repeat(auto-fit,minmax(120px,1fr));
				gap:20px;
				align-items:center;
			}

			.egg-button{
				--size:120px;
				width:var(--size);
				height:var(--size);
				margin:0 auto;
				position:relative;
				cursor:pointer;
				outline:none;
				border-radius:50%;
				display:flex;
				align-items:center;
				justify-content:center;
				user-select:none;
				-webkit-tap-highlight-color: transparent;
			}

			/* egg surface */
			.egg{
				width:88%;
				height:88%;
				background: radial-gradient(circle at 30% 25%, #fff 0%, var(--egg) 40%, #f0efe6 100%);
				border-radius:50% 50% 45% 45% / 50% 50% 55% 55%;
				box-shadow: 0 8px 18px var(--egg-shadow), inset -6px -8px 18px rgba(0,0,0,0.03);
				position:relative;
				transition:transform .12s ease;
			}

			.egg-button:active .egg{transform:translateY(3px) scale(.995)}

			/* crack layers using pseudo elements */
			.egg::before,
			.egg::after{
				content:"";
				position:absolute;
				left:50%;
				top:50%;
				transform:translate(-50%,-50%);
				width:70%;
				height:70%;
				pointer-events:none;
				opacity:0;
				transition:opacity .18s ease, filter .18s ease;
			}

			/* light crack */
			.egg.cracked-1::before{
				opacity:1;
				background-image:radial-gradient(circle at 40% 40%, transparent 0 22%, rgba(0,0,0,0.02) 23%),
													linear-gradient(120deg, transparent 0 48%, var(--crack) 49% 51%, transparent 52%),
													linear-gradient(60deg, transparent 0 48%, var(--crack) 49% 51%, transparent 52%);
				filter:blur(.4px) saturate(.9);
			}

			/* deeper crack */
			.egg.cracked-2::before{
				opacity:1;
				background-image:radial-gradient(circle at 40% 40%, transparent 0 18%, rgba(0,0,0,0.04) 19%),
													linear-gradient(120deg, transparent 0 45%, var(--crack) 46% 54%, transparent 55%),
													linear-gradient(60deg, transparent 0 45%, var(--crack) 46% 54%, transparent 55%);
				filter:blur(.2px) saturate(1.1);
			}

			/* ready to pop (visible big crack + fragment) */
			.egg.cracked-3::before{
				opacity:.95;
				background-image:linear-gradient(120deg, rgba(0,0,0,0.05) 0 20%, var(--crack) 21% 28%, transparent 29%),
												 linear-gradient(60deg, rgba(0,0,0,0.03) 0 18%, var(--crack) 19% 26%, transparent 27%),
												 radial-gradient(circle at 30% 35%, rgba(255,255,255,0.6) 0 6%, transparent 7%);
				filter:contrast(1.02);
			}

			/* fractured fragment visual */
			.egg.cracked-3::after{
				opacity:1;
				width:40%;
				height:40%;
				background:linear-gradient(180deg, rgba(0,0,0,0.03), rgba(255,255,255,0.2));
				transform:translate(-40%,-30%) rotate(-18deg);
				border-radius:30% 40% 20% 60% / 30% 40% 20% 60%;
			}

			/* chick */
			.chick{
				width:70%;
				height:70%;
				position:relative;
				border-radius:50%;
				background:linear-gradient(180deg,#fff176,#ffd54f);
				box-shadow: 0 6px 14px rgba(0,0,0,0.12), inset 0 -6px 10px rgba(0,0,0,0.04);
				display:flex;
				align-items:center;
				justify-content:center;
				transform:translateY(6px) scale(.98);
				animation:pop .28s ease forwards;
			}

			.chick::before{ /* eyes */
				content:"";
				position:absolute;
				width:10%;
				height:10%;
				background:#231f20;
				border-radius:50%;
				left:38%;
				top:40%;
				box-shadow:18px 0 0 #231f20;
			}

			.chick::after{ /* beak */
				content:"";
				position:absolute;
				width:18%;
				height:12%;
				background:linear-gradient(180deg,#ffb74d,#ff8a65);
				left:41%;
				top:54%;
				transform:translateX(-50%) rotate(20deg);
				clip-path: polygon(50% 0, 0% 100%, 100% 100%);
			}

			@keyframes pop{
				0%{transform:translateY(18px) scale(.8);opacity:0}
				60%{transform:translateY(-6px) scale(1.06);opacity:1}
				100%{transform:translateY(0) scale(1)}
			}

			.egg-label{font-size:13px;color:#444;text-align:center;margin-top:8px}

			@media (max-width:420px){
				.egg-button{--size:92px}
			}
		</style>
	</head>
	<body>
		<div class="wrap">
			<h1>卵をタップして割ってみよう（3回でひよこが出ます）</h1>

			<div class="grid" id="eggGrid" aria-live="polite">
				<!-- JavaScript will populate eggs here -->
			</div>
		</div>

		<script>
			(function(){
				const EGG_COUNT = 6; // 変更可
				const grid = document.getElementById('eggGrid');

				// Contract:
				// - Each egg starts with hits=0
				// - On click/tap/keyboard (Enter/Space): increment hits
				// - hits 1 -> cracked-1, hits 2 -> cracked-2, hits 3 -> cracked-3 then replace with chick

				function createEgg(index){
					const btn = document.createElement('button');
					btn.className = 'egg-button';
					btn.setAttribute('aria-label', `卵 ${index+1}：まだ割れていません`);
					btn.type = 'button';

					const egg = document.createElement('div');
					egg.className = 'egg';
					egg.dataset.hits = '0';

					btn.appendChild(egg);

					const label = document.createElement('div');
					label.className = 'egg-label';
					label.textContent = 'たたく';

					const container = document.createElement('div');
					container.style.textAlign='center';
					container.appendChild(btn);
					container.appendChild(label);

					// event handler
					function applyHit(){
						let hits = parseInt(egg.dataset.hits,10)||0;
						if(hits >= 3) return;
						hits += 1;
						egg.dataset.hits = String(hits);
						egg.classList.remove('cracked-1','cracked-2','cracked-3');
						egg.classList.add('cracked-' + hits);
						if(hits >= 3){
							// small timeout for visual of cracked-3 before popping
							egg.setAttribute('aria-hidden','true');
							btn.setAttribute('aria-label', `卵 ${index+1}：ひよこが生まれました`);
							setTimeout(()=>{
								showChick(egg,btn,index);
							},150);
						} else {
							btn.setAttribute('aria-label', `卵 ${index+1}：ひび ${hits} 回`);
						}
					}

					btn.addEventListener('click', applyHit);
					btn.addEventListener('touchstart', (e)=>{ e.preventDefault(); applyHit(); }, {passive:false});
					btn.addEventListener('keydown', (e)=>{
						if(e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar'){
							e.preventDefault(); applyHit();
						}
					});

					return container;
				}

				function showChick(eggEl, btnEl, index){
					// remove cracked classes
					eggEl.className = 'chick';
					eggEl.removeAttribute('data-hits');
					// remove focusable from button contents
					btnEl.disabled = true;
					const label = btnEl.parentElement.querySelector('.egg-label');
					if(label) label.textContent = 'ひよこ！';
				}

				// populate grid
				for(let i=0;i<EGG_COUNT;i++){
					grid.appendChild(createEgg(i));
				}

				// Helpful: allow dynamically adding eggs (example)
				window.__eggEffect = { addEgg: ()=>{ grid.appendChild(createEgg(grid.children.length)); } };
			})();
		</script>
	</body>
</html>

