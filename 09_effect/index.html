<!doctype html>
<html lang="ja">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>09_effect - 音再生テスト</title>
	<style>
		body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN",Meiryo, sans-serif;padding:2rem}
		button{font-size:1.1rem;padding:0.6rem 1rem;border-radius:6px;border:1px solid #444;background:#fff;cursor:pointer}
	</style>
</head>
<body>
	<h1>音の再生テスト</h1>
	<p>下のボタンを押すと音が鳴ります。</p>
	<button id="playBtn">音を再生</button>

	<script>
		(function(){
			// soundファイルの相対パス (09_effect/index.html から見たパス)
			const audioSrc = '../sound/charan.mp3';

			// Audio オブジェクトを作成してプリロード
			const audio = new Audio(audioSrc);
			audio.preload = 'auto';

			const btn = document.getElementById('playBtn');

			function playSound(){
				try {
					// 再生位置を先頭に戻して再生
					audio.currentTime = 0;
					const promise = audio.play();
					if (promise !== undefined) {
						promise.catch(err => {
							// 自動再生規制等で再生に失敗した場合の情報を出す
							console.warn('Audio play failed:', err);
						});
					}
				} catch (e) {
					console.error('playSound error:', e);
				}
			}

			btn.addEventListener('click', playSound);

			// モバイルでのタッチでの先行アンロック（必要なら）
			btn.addEventListener('touchstart', function(){
				// 一度短く再生してすぐ止めることで音声デコーダをアンロックできる場合がある
				audio.play().then(()=>{ audio.pause(); audio.currentTime = 0; }).catch(()=>{});
			}, {passive:true});
		})();
	</script>
</body>
</html>

